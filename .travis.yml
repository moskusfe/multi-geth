language: go
go_import_path: github.com/ethereum/go-ethereum
sudo: false
matrix:
  include:
  - os: linux
    dist: xenial
    go: 1.13.x
    script:
    - go run build/ci.go install
    - travis_wait 60 go run build/ci.go test
    before_deploy:
    - sh build/deploy.sh
    deploy:
      provider: releases
      api_key:
        secure: xCMMfSpYcDaUrPrFTVUACicdS0rRmAv/eNayVD8oEDBR6f2ysUfPeChUjY14WsHRaOMzD9MahQXZ+ZNcMDsduo3ZGL9sfSvivSa7tDS8rX/JdYO9dGQtOrgU2R/+XtBbc0JH6N/VVxp1YsTxNCblnGf6VGqXcjk0zW4TvfoLZ5+0EewdhJDycFZDCCDWT0gLH0syOuoENaPRECi1tiFDI5CAlDT+NLtMncxGX8FK8L9kdzqpODml859W87kMf3UU/n4gMrr+icBLq7lmBnDT0DFv7Su3Kd8saWFWlobbWthx8wMTPnFb9KQDan0tNNqd3uv5dbmVh3hvuBpNBLsHGpoHua2qE4np56jntOqd8s8AYdKxxK1v303ZGwC6ln7QuAbvwYZUcwHQGoVJzoUXprPAJzizA41NwuhQ6tzBDwtpvZONgzLN8scOtYPHf2CNKQLk2w2PgZays4nZVFFmjm7TceHtQVsSEc7qK6RM33ZIulAIHKqs0qXuoBQCFLq7kYDnsEhFto5+/kvEb2RVrAV5TsZNoOVkTudHnrQLtF7eo1zRBpMaZgZr5VdlbEUnFOJE/GB8TAi/MzGp6rVaTZ+aW+VQDHb+luqi/tXmj7V9IvX3YY7W6NnuIu4EpiBW5nKaj/lUtQl0sQIsrLF0QGlts43lS3zTQCwe10qqeAM=
      file: multi-geth*-$TRAVIS_OS_NAME.*
      file_glob: true
      draft: true
      on:
        repo: etclabscore/multi-geth
        tags: true
      skip_cleanup: true
      tag_name: "$TRAVIS_TAG"
  - os: linux
    dist: xenial
    sudo: required
    go: 1.13.x
    env:
      - ARMv5 
    git:
      submodules: false # avoid cloning ethereum/tests
      addons:
        apt:
          packages:
            - gcc-multilib
          script:
            # Switch over GCC to cross compilation (breaks 386, hence why do it here only)
            - sudo -E apt-get -yq --no-install-suggests --no-install-recommends --force-yes install gcc-arm-linux-gnueabi libc6-dev-armel-cross gcc-arm-linux-gnueabihf libc6-dev-armhf-cross gcc-aarch64-linux-gnu libc6-dev-arm64-cross
            - sudo ln -s /usr/include/asm-generic /usr/include/asm
            - GOPATH=~/go_arm GOARM=5 go run build/ci.go install -arch arm -cc arm-linux-gnueabi-gcc
          before_deploy:
            - sh build/deploy_arm.sh
          deploy:
            provider: releases
            api_key:
              secure: xCMMfSpYcDaUrPrFTVUACicdS0rRmAv/eNayVD8oEDBR6f2ysUfPeChUjY14WsHRaOMzD9MahQXZ+ZNcMDsduo3ZGL9sfSvivSa7tDS8rX/JdYO9dGQtOrgU2R/+XtBbc0JH6N/VVxp1YsTxNCblnGf6VGqXcjk0zW4TvfoLZ5+0EewdhJDycFZDCCDWT0gLH0syOuoENaPRECi1tiFDI5CAlDT+NLtMncxGX8FK8L9kdzqpODml859W87kMf3UU/n4gMrr+icBLq7lmBnDT0DFv7Su3Kd8saWFWlobbWthx8wMTPnFb9KQDan0tNNqd3uv5dbmVh3hvuBpNBLsHGpoHua2qE4np56jntOqd8s8AYdKxxK1v303ZGwC6ln7QuAbvwYZUcwHQGoVJzoUXprPAJzizA41NwuhQ6tzBDwtpvZONgzLN8scOtYPHf2CNKQLk2w2PgZays4nZVFFmjm7TceHtQVsSEc7qK6RM33ZIulAIHKqs0qXuoBQCFLq7kYDnsEhFto5+/kvEb2RVrAV5TsZNoOVkTudHnrQLtF7eo1zRBpMaZgZr5VdlbEUnFOJE/GB8TAi/MzGp6rVaTZ+aW+VQDHb+luqi/tXmj7V9IvX3YY7W6NnuIu4EpiBW5nKaj/lUtQl0sQIsrLF0QGlts43lS3zTQCwe10qqeAM=
              file: multi-geth*-arm.*
              file_glob: true
              draft: true
              on:
                repo: moskusfe/multi-geth
                tags: true
                skip_cleanup: true
                tag_name: "$TRAVIS_TAG"
  - os: osx
    go: 1.13.x
    script:
    - echo "Increase the maximum number of open file descriptors on macOS"
    - NOFILE=20480
    - sudo sysctl -w kern.maxfiles=$NOFILE
    - sudo sysctl -w kern.maxfilesperproc=$NOFILE
    - sudo launchctl limit maxfiles $NOFILE $NOFILE
    - sudo launchctl limit maxfiles
    - ulimit -S -n $NOFILE
    - ulimit -n
    - unset -f cd
    - go run build/ci.go install
    before_deploy:
    - sh build/deploy.sh
    deploy:
      provider: releases
      api_key:
        secure: xCMMfSpYcDaUrPrFTVUACicdS0rRmAv/eNayVD8oEDBR6f2ysUfPeChUjY14WsHRaOMzD9MahQXZ+ZNcMDsduo3ZGL9sfSvivSa7tDS8rX/JdYO9dGQtOrgU2R/+XtBbc0JH6N/VVxp1YsTxNCblnGf6VGqXcjk0zW4TvfoLZ5+0EewdhJDycFZDCCDWT0gLH0syOuoENaPRECi1tiFDI5CAlDT+NLtMncxGX8FK8L9kdzqpODml859W87kMf3UU/n4gMrr+icBLq7lmBnDT0DFv7Su3Kd8saWFWlobbWthx8wMTPnFb9KQDan0tNNqd3uv5dbmVh3hvuBpNBLsHGpoHua2qE4np56jntOqd8s8AYdKxxK1v303ZGwC6ln7QuAbvwYZUcwHQGoVJzoUXprPAJzizA41NwuhQ6tzBDwtpvZONgzLN8scOtYPHf2CNKQLk2w2PgZays4nZVFFmjm7TceHtQVsSEc7qK6RM33ZIulAIHKqs0qXuoBQCFLq7kYDnsEhFto5+/kvEb2RVrAV5TsZNoOVkTudHnrQLtF7eo1zRBpMaZgZr5VdlbEUnFOJE/GB8TAi/MzGp6rVaTZ+aW+VQDHb+luqi/tXmj7V9IvX3YY7W6NnuIu4EpiBW5nKaj/lUtQl0sQIsrLF0QGlts43lS3zTQCwe10qqeAM=
      file: multi-geth*-$TRAVIS_OS_NAME.*
      file_glob: true
      draft: true
      on:
        repo: etclabscore/multi-geth
        tags: true
      skip_cleanup: true
      tag_name: "$TRAVIS_TAG"
  - os: linux
    dist: xenial
    go: 1.13.x
    env:
    - lint
    git:
      submodules: false
    script:
    - go run build/ci.go lint
